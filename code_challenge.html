<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GPU Code Runner</title>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #editor { width: 100%; height: 400px; border: 1px solid #ccc; }
    #runBtn { margin-top: 10px; padding: 8px 16px; font-size: 16px; }
    #output { margin-top: 10px; padding: 10px; width: 100%; border:1px solid #ccc; background:#f4f4f4; min-height:50px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>GPU Code Runner</h1>
  
  <div id="editor"></div>
  <br>
  <button id="runBtn">Run Code</button>
  
  <h2>Output:</h2>
  <pre id="output"></pre>

  <script>
    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs' } });

    require(['vs/editor/editor.main'], function () {
        // Register CUDA language
        monaco.languages.register({ id: 'cuda' });

        monaco.languages.setMonarchTokensProvider('cuda', {
            tokenizer: {
                root: [
                    [/\b(__global__|__device__|__host__|__shared__|__constant__|__managed__|__syncthreads)\b/, 'keyword'],
                    [/[<]{3}|[>]{3}/, 'keyword'],
                    [/\b(int|float|double|char|void|if|else|for|while|return|struct|class|public|private|virtual|template|typename|using|namespace|const|volatile|static)\b/, 'keyword'],
                    [/[a-zA-Z_]\w*/, 'identifier'],
                    [/\d+(\.\d+)?/, 'number'],
                    [/".*?"/, 'string'],
                    [/\/\/.*$/, 'comment'],
                    [/\/\*/, { token: 'comment', next: '@comment' }]
                ],
                comment: [
                    [/[^\/*]+/, 'comment'],
                    [/\*\//, 'comment', '@pop'],
                    [/[\/*]/, 'comment']
                ]
            }
        });

        // Create the editor
        window.editor = monaco.editor.create(document.getElementById('editor'), {
            value: `#include <stdio.h>\n\n__global__ void kernel() {\n    printf("Hello CUDA!\\n");\n}\n\nint main() {\n    kernel<<<1,1>>>();\n    return 0;\n}`,
            language: 'cuda',
            theme: 'vs-dark',
            automaticLayout: true
        });
    });

    const runBtn = document.getElementById('runBtn');
    const output = document.getElementById('output');

    runBtn.addEventListener('click', async () => {
      const code = window.editor.getValue();

      try {
        const response = await fetch('https://v0rf8tnichlila-8000.proxy.runpod.net/run', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code })
        });

        const result = await response.json();

        if (result.error) {
          output.textContent = "Error: " + result.error;
        } else {
          output.textContent = `Exit code: ${result.exit_code}\nSTDOUT:\n${result.stdout}\nSTDERR:\n${result.stderr}`;
        }
      } catch (err) {
        output.textContent = 'Request failed: ' + err;
      }
    });
  </script>
</body>
</html>
