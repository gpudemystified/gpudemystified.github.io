<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ '/assets/css/default_header.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/article_page.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/markdown_light.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/syntax.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/notes.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/auth_modal.css' | relative_url }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="{{ '/assets/js/auth_modal.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/supabase-config.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/profile_utils.js' | relative_url }}"></script>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q40XGC4DQS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q40XGC4DQS');
</script>

<body>
    <div class="header-container">
        <button class="login-btn" id="login-btn">Login</button>
        <div class="user-stats" id="user-stats" style="display: none;">
            <span class="account-badge" id="account-badge">Basic</span>
            <div class="stat-item" title="Submissions left">
                <span id="submissions-count">0</span>
                <i class="fas fa-code"></i>
            </div>
            <div class="stat-item" title="Hints left">
                <span id="hints-count">0</span>
                <i class="fas fa-lightbulb"></i>
            </div>
            <div class="stat-item" title="Points earned">
                <span id="points-count">0</span>
                <i class="fas fa-star"></i>
            </div>
            <button class="logout-btn" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>
        </div>
        <header class="site-header">
        <div class="header-top">
          <img src="/assets/images/Logo.jpg" alt="Logo" class="logo" />
          <div class="site-title-desc">
            <h1 class="site-name">gpudemystified</h1>
            <p class="site-description">GPU Architectures & Programming.
              CUDA, NVIDIA & AMD Architectures | Algorithms | GPU Optimization ‚Äî all demystified üîç</p>
          
    
          <div class="social-logos-row">
        <div class="social-logos">
          <a href="https://www.linkedin.com/in/galazar/" target="_blank" rel="noopener">
            <img src="/assets/images/linkedin.svg" alt="LinkedIn" class="social_logo">
          </a>
          <a href="https://www.instagram.com/gpudemystified/" target="_blank" rel="noopener">
            <img src="/assets/images/instagram.svg" alt="Instagram" class="social_logo">
          </a>
          <!-- <a href="https://github.com/gpudemystified" target="_blank" rel="noopener">
            <img src="/assets/images/github.svg" alt="GitHub" class="social_logo">
          </a> -->
          <a href="mailto:contact@gpudemystified.com" target="_blank" rel="noopener">
            <img src="/assets/images/gmail.svg" alt="Email" class="social_logo">
          </a>
        </div>
        <button class="subscribe-btn" id="subscribe-btn">Newsletter</button>
      </div>
      </div>
        </div>

        <nav class="main-nav">
          <ul>
              <li>
            <a href="/index"
               class="nav-link {% if page.url contains 'articles' or page.url == '/' %}active{% endif %}"
               onclick="gtag('event', 'nav_click_articles', { event_category: 'navigation', event_label: 'Articles' });">
               Articles
            </a>
          </li>
          <li>
            <a href="/notes"
               class="nav-link {% if page.url contains 'notes' %}active{% endif %}"
               onclick="gtag('event', 'nav_click_notes', { event_category: 'navigation', event_label: 'Notes' });">
               Notes
            </a>
          </li>
          <li>
            <a href="/challenge"
               class="nav-link {% if page.url contains 'challenge' %}active{% endif %}"
               onclick="gtag('event', 'nav_click_challenges', { event_category: 'navigation', event_label: 'Challenges' });">
               Challenges
            </a>
          </li>
            <a href="/leaderboard"
                class="nav-link {% if page.url contains 'leaderboard' %}active{% endif %}"
                onclick="gtag('event', 'nav_click_leaderboard', { event_category: 'navigation', event_label: 'Leaderboard' });">
                Leaderboard
              </a>
          </ul>
        </nav>

        <hr class="header-divider" />
      </header>
    </div>

  <main>
    {{ content }}

  <!-- Newsletter Modal -->
  <div id="newsletterModal" class="lb-modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="lb-overlay" data-close></div>
    <div class="lb-content" role="document" aria-labelledby="lb-title" aria-describedby="lb-desc">
      <button class="lb-close" aria-label="Close (Esc)" title="Close">&times;</button>
    
       <div class="lb-text newsletter-content" id="newsletter-desc"> 
        <h2 id="newsletter-title">Subscribe the newsletter</h2> 
        <p class="lb-description">Monthly, curated GPU-related stuff</p>
         <div class="newsletter-form"> 
          <input type="email" id="newsletter-email" placeholder="Enter your email" /> 
          <button id="newsletter-submit" disabled>Coming soon</button> 
         <div id="thankyou-wrapper" style="display:none; justify-content:center; margin-top:1rem;">
            <button id="newsletter-thankyou">Thank you!</button>
        </div>
        </div> 
     
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="auth-modal">
    <div class="auth-modal-overlay"></div>
    <div class="auth-modal-content">
        <button class="auth-modal-close">&times;</button>
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="signin">Sign In</button>
            <button class="auth-tab" data-tab="register">Register</button>
        </div>
        
        <div class="auth-form-container">
            <!-- Sign In Form -->
            <form id="signinForm" class="auth-form active">
                <div class="auth-social">
                    <button type="button" class="auth-social-btn github">
                        <i class="fab fa-github"></i>
                        Continue with GitHub
                    </button>
                    <button type="button" class="auth-social-btn google">
                        <i class="fab fa-google"></i>
                        Continue with Google
                    </button>
                </div>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <div class="auth-input-group">
                    <input type="email" placeholder="Email" required>
                </div>
                <div class="auth-input-group">
                    <input type="password" placeholder="Password" required>
                </div>
                <button type="submit" class="auth-submit">Sign In</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="auth-form">
                <div class="auth-social">
                    <button type="button" class="auth-social-btn github">
                        <i class="fab fa-github"></i>
                        Sign up with GitHub
                    </button>
                    <button type="button" class="auth-social-btn google">
                        <i class="fab fa-google"></i>
                        Sign up with Google
                    </button>
                </div>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <div class="auth-input-group">
                    <input type="email" placeholder="Email" required>
                </div>
                <div class="auth-input-group">
                    <input type="password" placeholder="Password" required>
                </div>
                <div class="auth-input-group">
                    <input type="password" placeholder="Confirm Password" required>
                </div>
                <button type="submit" class="auth-submit">Create Account</button>
            </form>
        </div>
    </div>
</div>

<!-- Pro Modal -->
<div id="proModal" class="pro-modal">
    <div class="pro-modal-overlay"></div>
    <div class="pro-modal-content">
        <button class="pro-modal-close">&times;</button>
        <div class="pro-modal-body">
            <h2><i class="fas fa-crown"></i> Pro Benefits</h2>
            <div class="pro-benefits">
                <div class="benefit-item">
                    <i class="fas fa-infinity"></i>
                    <span>Unlimited Code Submissions</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-lightbulb"></i>
                    <span>Unlimited Hints</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-rocket"></i>
                    <span>Advanced Compilation Options</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Detailed Performance Analytics</span>
                </div>
            </div>
            <button id="confirmUpgrade" class="confirm-upgrade-button">
                <span>Upgrade to Pro</span>
                <span class="price">$9.99</span>
            </button>
        </div>
    </div>
</div>

</main>

</body>
<script>

const newsletterBtn = document.getElementById("subscribe-btn"); // your button
const newsletterModal = document.getElementById("newsletterModal");
const newsletterClose = newsletterModal.querySelector(".lb-close");
const newsletterOverlay = newsletterModal.querySelector(".lb-overlay");

// Open
newsletterBtn.addEventListener("click", () => {
  console.log('Opening newsletter modal');

   gtag('event', 'newsletter_click', {
      'event_category': 'newsletter',
      'event_label': 'Newsletter Button Clicked'
    });

    newsletterModal.setAttribute('aria-hidden', 'false');
    newsletterModal.classList.add('open');
    
    newsletterModal.style.display = 'flex'; // show it again
    document.addEventListener('keydown', handleKeyDown);
    document.body.style.overflow = 'hidden';
});

// Close
function closeNewsletter() {
  newsletterModal.setAttribute("aria-hidden", "true");
  newsletterModal.style.display = "none";
  document.body.classList.remove("no-scroll");
  document.body.style.overflow = ''; // restore scroll
}

newsletterClose.addEventListener("click", closeNewsletter);
newsletterOverlay.addEventListener("click", closeNewsletter);

// Keyboard navigation
  function handleKeyDown(e){
    if(e.key === 'Escape'){ closeNewsletter(); return; }
  }


document.addEventListener('DOMContentLoaded', () => {
  const thankYouWrapper = document.getElementById('thankyou-wrapper');
  const emailInput = document.getElementById('newsletter-email');
  const submitButton = document.getElementById('newsletter-submit');

 submitButton.addEventListener('click', async () => {
    const email = emailInput.value.trim();
    if (!email) return alert('Please enter your email');

    const url = 'https://script.google.com/macros/s/AKfycbwQQ7RuWhyfryCVGxZiXIdE8R-Ie6BFSJacBUNHffnIz0Wy2EedBu8n9vCIysZERjgRaQ/exec';
    const formData = new FormData();
    formData.append('email', email);

    try {
      const response = await fetch(url, {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        emailInput.style.display = 'none';
        submitButton.style.display = 'none';
        thankYouWrapper.style.display = 'flex';
      } else {
        alert('Something went wrong. Please try again.');
      }
    } catch (err) {
      console.error(err);
      alert('Error sending request. Please try again.');
    }
  });
});

</script>